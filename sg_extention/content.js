function addExtensionContent(){let e=document.createElement("div");if(e.setAttribute("id","extBody"),e.innerHTML=`
  <button class="ext-logo">
    <img src="${chrome.runtime.getURL("images/logo_w.png")}" alt="Akira HT" />
  </button>
  <div id="extSgModule">
    <div id="akiraExt">
      <div class="logo">
        <h2 class="ext-title">HTML Convert Editable</h2>
        <div id="clSelect">
          <span class="dot dotActive"></span>
          <div class="list-color">
            <span id="color00" class="dot"></span>
            <span id="color01" class="dot"></span>
            <span id="color02" class="dot"></span>
            <span id="color03" class="dot"></span>
            <span id="color04" class="dot"></span>
          </div>
        </div>
      </div>
      <div class="inp-gr">
        <div class="pc-files">
          <div class="akiraExt-input">
            <input type="file" accept=".html" id="fileInput">
            <span id="fileNameSpan">PC file html</span>
          </div>
        </div>
        <div class="sp-files">
          <div class="akiraExt-input">
            <input type="file" accept=".html" id="fileInput_sp">
            <span id="fileNameSpan_sp">SP file html</span>
          </div>
        </div>
        <div style="display: flex; width: 100%;">
          <div class="akiraExt-num">
            <input type="number" id="colorCountInput">
          </div>
          <div class="akiraExt-btn --r">
            <button id="extract-html" title="Extract HTML"></button>
          </div>
          <div class="akiraExt-btn --c">
            <button id="clean-html" title="Clear data"></button>
          </div>
          <div class="akiraExt-btn --data d-none">
            <button id="reData" title="Filter Module"></button>
          </div>
        </div>
      </div>
    </div>
    <div class="manualNote">
      <ul>
        <li>HTML files need a wrapper class='root'</li>
        <li>Add attribute for module: <span style="color: red;">data-module</span>, <span style="color: red;">data-css</span>, <span style="color: red;">data-type-name</span>
          <ol>
            <li><span style="color: red;">data-module</span>: The PC/SP files need to be the same for module mapping.</li>
            <li><span style="color: red;">data-css</span>: file name css use for this module</li>
            <li><span style="color: red;">data-type-name</span>: Module type of this module</li>
          </ol>
        </li>
        <li>Please check the 'Module type' carefully, as this value cannot be edited.</li>
      </ul>
    </div>
    <div class="blockReturn">
      <div class="blockReturn__first">
        <div class="blockReturn__total">
          Total module <span class="txt-error"></span>
          <div>
            <div class="blockReturn-head -l">
              <div style="display: flex; padding: 10px 0;">PC<p id="ttModule_pc"></p></div>
              <div class="inputFile_sty">
                <span>CSS for PC</span>
                <input type="file" accept=".css" id="cssFiles" multiple>
              </div>
            </div>
            <div class="blockReturn-head -r">
              <div style="display: flex; padding: 10px 0;">SP<p id="ttModule_sp"></p></div>
              <div class="inputFile_sty">
                <span>CSS for SP</span>
                <input type="file" accept=".css" id="cssFiles_sp" multiple>
              </div>
            </div>
          </div>
        </div>
        <div class="blockReturn__l">
          <div class="htmlDisplay"></div>
        </div>
        <div class="blockReturn__r">
          <div class="htmlDisplay_sp"></div>
        </div>
      </div>
      <div class="blockReturn__module d-none"></div>
    </div>
  </div>
`,document.body){document.body.appendChild(e);let t=atob("Q29weXJpZ2h0IKkgQWtpcmEgSHQ="),l=document.createElement("span"),a=document.getElementById("extBody");l.className="cr",l.innerHTML=t,a.appendChild(l)}else console.error("msg page can't run")}function handleFileChange(e,t){let l=e.files[0];l?t.innerText=l.name:t.innerText="No file chosen"}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",addExtensionContent):addExtensionContent(),document.getElementById("fileInput").addEventListener("change",function(){handleFileChange(this,document.getElementById("fileNameSpan"))}),document.getElementById("fileInput_sp").addEventListener("change",function(){handleFileChange(this,document.getElementById("fileNameSpan_sp"))});const bodySite=document.querySelector("body[class='relative bg-vars-bg-primary text-vars-txt-primary antialiased']"),btnShow=document.querySelector(".ext-logo"),manualNote=document.querySelector(".manualNote"),ttModulPc=document.getElementById("ttModule_pc"),ttModulSp=document.getElementById("ttModule_sp"),blockReturn=document.querySelector(".blockReturn"),blockReturnFirst=document.querySelector(".blockReturn__first"),blockReturnModule=document.querySelector(".blockReturn__module"),inputCssFiles=document.getElementById("cssFiles"),inputCssFiles_sp=document.getElementById("cssFiles_sp"),htmlDisplay=document.querySelector(".htmlDisplay"),htmlDisplay_sp=document.querySelector(".htmlDisplay_sp"),btnReUp=document.getElementById("reData"),errorTotal=document.querySelector(".txt-error"),inpGr=document.querySelector(".inp-gr").querySelectorAll("input");async function waitForElement(e,t=2e5){return new Promise((l,a)=>{let i=setInterval(()=>{let t=document.querySelector(e);t&&(clearInterval(i),l(t))},100);setTimeout(()=>{clearInterval(i),a(Error(`Element not found after ${t}ms`))},t)})}async function waitForSP(e){return new Promise(t=>{let l=new MutationObserver((l,a)=>{for(let i of l)if("childList"===i.type){let n=document.querySelector(e);if(n){a.disconnect(),t(n);return}}});l.observe(document.body,{childList:!0,subtree:!0})})}async function waitForListBox(){return new Promise((e,t)=>{let l=setInterval(()=>{let t=document.querySelector('div[data-slot="base"] ul[data-slot="list"]');t&&t.querySelectorAll("li").length>0&&(clearInterval(l),e(t))},100);setTimeout(()=>{clearInterval(l),t(Error("Timeout waiting for listBoxModule"))},1e4)})}function wait(e){return new Promise(t=>setTimeout(t,e))}errorTotal.innerText="",btnShow.addEventListener("click",function(){let e=document.getElementById("extSgModule");e.classList.toggle("extModule-off"),document.body.classList.toggle("ext-off")}),document.getElementById("extract-html").addEventListener("click",async function(){manualNote.classList.add("d-none"),document.querySelector(".htmlDisplay").innerHTML="",document.querySelector(".htmlDisplay_sp").innerHTML="",blockReturn.classList.remove("rModule"),blockReturnFirst.classList.remove("d-none");let e=parseInt(document.getElementById("colorCountInput").value,10);if(isNaN(e)||e<=0){alert("Please enter a valid number of colors.");return}await handleFileProcessing(document.getElementById("fileInput"),document.querySelector(".htmlDisplay"),e,!0),await handleFileProcessing(document.getElementById("fileInput_sp"),document.querySelector(".htmlDisplay_sp"),e,!1);let t=countBlocks(document.querySelector(".htmlDisplay")),l=countBlocks(document.querySelector(".htmlDisplay_sp"));ttModulPc.innerText=": "+t+" modules",ttModulSp.innerText=": "+l+" modules",btnReUp.parentNode.classList.remove("d-none"),t!==l?(errorTotal.innerText=" (Unequal number of modules)",btnReUp.parentNode.classList.add("disable")):(errorTotal.innerText="",btnReUp.parentNode.classList.remove("disable")),blockReturn.style.display="block"});const toastify=document.querySelector(".Toastify");function copyContent(e,t){let l=document.createRange();l.selectNodeContents(e);let a=window.getSelection();a.removeAllRanges(),a.addRange(l),document.execCommand("copy"),a.removeAllRanges(),t.classList.add("loading"),setTimeout(()=>{t.classList.remove("loading")},300)}function getBlockComment(e){let t=e.previousSibling;for(;t;){if(t.nodeType===Node.COMMENT_NODE)return"\n<!-- "+t.nodeValue.trim()+" -->\n";t=t.previousSibling}return""}function getBlockHtml(e,t=""){var l="";if(e){l+=t+"<"+e.tagName.toLowerCase();for(var a=0;a<e.attributes.length;a++){var i=e.attributes[a];l+=" "+i.name+'="'+i.value+'"'}if(l+=">",e.childNodes.length>0){for(var n=t+"	",o=!1,a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(3===r.nodeType){var s=r.nodeValue.trim();s&&(l+="\n"+n+s)}else if(1===r.nodeType){var d=getBlockHtml(r,n);d&&(l+="\n"+d,o=!0)}}(o||l.includes(n))&&(l+="\n"+t)}l+="</"+e.tagName.toLowerCase()+">"}return l}document.getElementById("reData").addEventListener("click",function(){inpGr.forEach(e=>{e.setAttribute("disabled","true")});let e=document.querySelectorAll(".htmlDisplay .block"),t=document.querySelectorAll(".htmlDisplay_sp .block");blockReturn.classList.add("rModule"),blockReturnFirst.classList.add("d-none"),blockReturnModule.classList.remove("d-none");let l=document.createElement("div");l.className="blockReturn__data";let a=document.createElement("div");a.className="tab";let i=Array.from(e).map(e=>e.getAttribute("data-module")),n=Array.from(t).map(e=>e.getAttribute("data-module")),o=document.createElement("button");o.id="btnClose",document.body.appendChild(o),o.addEventListener("click",function(){bodySite.classList.remove("moduleRun");let e=document.getElementsByTagName("nav")[0].getElementsByTagName("div"),t=e[2],l=t.getElementsByTagName("div"),a=l[2];a.click()}),i.forEach(i=>{if(n.includes(i)){let o=document.createElement("button");o.className="tablinks",o.innerText=i;let r=document.createElement("div");r.className="htmlDisplay",r.style.display="none";let s=Array.from(e).find(e=>e.getAttribute("data-module")===i),d=Array.from(t).find(e=>e.getAttribute("data-module")===i),c=document.createElement("button");if(c.innerText="Add",c.classList.add("btnAddModule"),s){let u=s.getAttribute("module-type"),p=document.createElement("div");p.className="module-header";let m=document.createElement("input");m.type="text",m.classList.add("module-type-name"),m.value=u||"",p.appendChild(m);let b=document.createElement("input");b.type="checkbox",b.id="confirmModule";let y=document.createElement("label");y.htmlFor="confirmModule",y.innerText="Confirm module",y.appendChild(b),p.appendChild(y),c.addEventListener("click",async function(){if(b.checked){bodySite.classList.add("moduleRun");let e=document.getElementById("root-layout"),t=e.querySelector('#root-layout > div > div[class="flex justify-between"] > button'),l=document.getElementsByTagName("nav")[0].getElementsByTagName("div"),a=l[2],i=a.getElementsByTagName("div"),n=null;if(t){t.click(),console.log("1. Click create module"),await waitForElement("#root-layout form"),console.log("2. Load form done");let o=!1,s=new MutationObserver(async(e,t)=>{if(!o){for(let l of e)if("childList"===l.type){let i=a.getElementsByTagName("div");if(i[3]){await y(),await p(i[3]),o=!0,t.disconnect();break}}}});s.observe(a,{childList:!0,subtree:!0});let d=!1;async function p(t){if(d)return;d=!0,console.log("3. Processing add module");let l=m.value,a=r.querySelector(".block.pc .block-cont .edit-cont code").textContent,o=r.querySelector(".block.pc .block-cont .css-cont code").textContent,s=r.querySelector(".block.sp .block-cont .edit-cont code").textContent,p=r.querySelector(".block.sp .block-cont .css-cont code").textContent,h=document.querySelector('.form-field[data-name="modules.0.module_type_id"] div[data-slot="inner-wrapper"]'),f=document.querySelector('.form-field[data-name="modules.0.color_set_id"] button[data-slot="trigger"]');async function v(){if(f){f.click(),await waitForElement('div[data-slot="popover"]');let e=document.querySelector('div[data-slot="popover"] ul[data-slot="listbox"]');if(e){let t=e.querySelector("li");t&&t.click()}}}if(h){h.click(),await waitForElement('ul[data-slot="list"]'),await new Promise(e=>setTimeout(e,300));let g=await waitForListBox(),E=g.querySelectorAll("li"),A=Array.from(E).map(e=>e.querySelector('span[data-label="true"]')),S=!1;for(let k of A)if(await waitForElement('div[data-slot="base"] ul[data-slot="list"]'),k&&k.innerText&&k.innerText.trim()===l){k.click(),S=!0,console.log("4. Module type name chosen"),await v(),console.log("5. Color palette chosen");let C=document.getElementById("modules.0.html.PC"),L=document.getElementById("modules.0.css.PC"),$=document.querySelector('div[data-name="modules.0.css.PC"]').nextElementSibling,x=e.querySelector('.form-field[data-name="modules.0.code"] button[type="button"]');if(C&&L&&x){let T=C.querySelector("textarea.ace_text-input"),q=L.querySelector("textarea.ace_text-input");async function N(e,t=5,l=2e3){let a=0;for(;a<t;){let i=document.querySelector('div[aria-label="Loading"]');if(i)return!0;console.log(`Retry ${a+1}: View module Clicked again`),e.click(),a++,await new Promise(e=>setTimeout(e,l))}}if(T.value=a,T.dispatchEvent(new Event("input",{bubbles:!0})),q.value=o,q.dispatchEvent(new Event("input",{bubbles:!0})),$){$.click(),console.log("6. View module Clicked");try{await N($)}catch(w){console.error(w.message)}}await waitForElement('div[aria-label="Loading"]'),await y(),x.click(),console.log("7. Switch to SP"),await waitForSP("#modules\\.0\\.html\\.SP");let M=document.getElementById("modules.0.html.SP"),B=document.getElementById("modules.0.css.SP");if(M&&B){let R=M.querySelector("textarea.ace_text-input"),I=B.querySelector("textarea.ace_text-input");R.value=s,R.dispatchEvent(new Event("input",{bubbles:!0})),I.value=p,I.dispatchEvent(new Event("input",{bubbles:!0}));let P=document.querySelector('div[data-name="modules.0.css.SP"]').nextElementSibling,_=document.querySelector('button[type="submit"]');P.click(),_&&"function"==typeof _.click&&(_.click(),console.log("8. Submit module"))}}break}let D=!1,F=new MutationObserver(e=>{e.forEach(e=>{if("childList"===e.type&&toastify){let t=toastify.querySelector(".Toastify__toast--success"),l=toastify.querySelector(".Toastify__toast--error");if(t)n=200,F.disconnect(),D||(console.log("9. Module "+u+" success"),console.log("/*================DONE================*/"),D=!0);else if(l){n=500;let a=i[2];a.click(),F.disconnect();return}let o=document.querySelector(".tablinks.active");200===n?(o.classList.remove("progressing"),o.classList.remove("error"),o.classList.add("added"),c.style.display="none",b.disabled=!0,bodySite.classList.remove("moduleRun")):500===n?(o.classList.remove("added"),o.classList.add("progressing"),bodySite.classList.remove("moduleRun")):(o.classList.remove("added"),o.classList.add("progressing"))}})});if(F.observe(document.body,{childList:!0,subtree:!0}),c.disabled=!1,!S){alert("Don't have module name: "+l),bodySite.classList.remove("moduleRun");let H=i[2];H.click();return}}d=!1}async function y(){return new Promise(e=>{let t=setInterval(()=>{let l=document.querySelector('div[aria-label="Loading"]');l||(clearInterval(t),console.log("Loading done"),e())},100)})}}}else{alert("Please confirm module "+u+" before adding!");return}}),p.appendChild(c),r.appendChild(p);let h=s.cloneNode(!0);h.classList.add("pc"),h.setAttribute("css-file","pc");let f=h.querySelector(".block-cont .edit-cont code"),v=h.querySelector(".block-cont .css-cont code"),g=document.createElement("button");g.className="copy-html-btn",g.textContent="HTML",g.addEventListener("click",function(){copyContent(f,g)});let E=document.createElement("button");E.className="copy-css-btn",E.textContent="CSS",E.addEventListener("click",function(){copyContent(v,E)});let A=document.createElement("div");A.classList.add("copyCont"),A.appendChild(g),A.appendChild(E),h.prepend(A),r.appendChild(h)}if(d){let S=d.cloneNode(!0);S.classList.add("sp"),S.setAttribute("css-file","sp");let k=S.querySelector(".block-cont .edit-cont code"),C=S.querySelector(".block-cont .css-cont code"),L=document.createElement("button");L.className="copy-html-btn",L.textContent="HTML",L.addEventListener("click",function(){copyContent(k,L)});let $=document.createElement("button");$.className="copy-css-btn",$.textContent="CSS",$.addEventListener("click",function(){copyContent(C,$)});let x=document.createElement("div");x.classList.add("copyCont"),x.appendChild(L),x.appendChild($),S.prepend(x),r.appendChild(S)}o.displayDiv=r,a.appendChild(o),l.appendChild(r);let T=document.createElement("button");async function q(){return console.log("Next module waiting ."),new Promise(e=>{let t=new MutationObserver((t,l)=>{console.log("Next module waiting .."),t.forEach(t=>{if("childList"===t.type){console.log("Next module waiting ...");let a=document.querySelector('#root-layout > div > div[class="flex justify-between"] > button');a&&(l.disconnect(),e(a))}})});t.observe(document.body,{childList:!0,subtree:!0})})}T.innerText="Add All Module",T.classList.add("btnAddModule_all"),blockReturnModule.innerHTML="",l.insertBefore(a,l.firstChild),blockReturnModule.appendChild(T),blockReturnModule.appendChild(l),T.addEventListener("click",async function(){let e=confirm("Are you sure you want to add all modules?");if(e){let t=a.querySelectorAll(".tablinks");for(let l=0;l<t.length;l++){let i=t[l],n=i.displayDiv.querySelector("#confirmModule"),o=i.displayDiv.querySelector(".btnAddModule");!(i.classList.contains("added")||i.classList.contains("error"))&&(i.click(),n&&(n.checked=!0,o.click(),await waitForElement(".Toastify__toast--success"),await new Promise(e=>{let t=setInterval(()=>{let l=document.querySelector(".Toastify__toast--success"),a=toastify.querySelector(".Toastify__progress-bar");a&&(a.style.animationDuration="500ms"),l||(clearInterval(t),e())},100)})),await waitForElement('#root-layout > div > div[class="flex justify-between"] > button'),console.log("0. Next module"))}T.disabled=!0,alert("All modules have been processed!")}}),o.addEventListener("click",function(){let e=l.querySelectorAll(".htmlDisplay");e.forEach(e=>e.style.display="none");let t=a.querySelectorAll(".tablinks");t.forEach(e=>e.classList.remove("active")),this.classList.add("active"),this.displayDiv.style.display="block"})}});let r=a.querySelector(".tablinks");if(r)r.click(),btnReUp.parentNode.classList.add("disable");else{let s=document.createElement("div");s.innerText="There is no module mapping between PC and SP, please check the data-module attribute on your HTML files",blockReturnModule.appendChild(s)}}),document.getElementById("clean-html").addEventListener("click",function(){inpGr.forEach(e=>{e.removeAttribute("disabled")}),manualNote.classList.remove("d-none");let e=document.querySelectorAll('input[type="file"]');e.forEach(e=>{e.value="";let t=e.parentElement.querySelector("span");t&&(t.innerText="No file chosen")}),document.getElementById("fileNameSpan").innerText="PC file html",document.getElementById("fileNameSpan_sp").innerText="SP file html",document.getElementById("colorCountInput").value="",blockReturn.style.display="none",blockReturn.classList.remove("rModule"),blockReturnModule.classList.add("d-none"),blockReturnModule.innerHTML="",blockReturnFirst.classList.remove("d-none"),htmlDisplay.innerHTML="",htmlDisplay_sp.innerHTML="",btnReUp.parentNode.classList.add("d-none"),btnReUp.parentNode.classList.remove("disable")});const attributesToCopy={headline:["class","data-max","data-sample","data-label","data-hint","data-monitor"],image:["class","data-aspect","data-readonly","data-monitor"],button:["class","data-max","data-sample","data-label","data-hint","data-empty"],text:["class","data-max","data-sample","data-label","data-hint","data-monitor"],iframe:["class","data-max","data-sample","data-label","data-hint"],job:["class","data-type","data-sample-thumbnail","data-sample-name","data-sample-description"],recruitment:["class","data-type","data-sample-thumbnail","data-sample-title","data-sample-type","data-sample-location","data-sample-salary","data-sample-salaryType","data-sample-companyName"],chart:["class","data-type","data-series","data-format"]},placeholderMapping={1:{label:"大見出し",hint:"大見出しが入ります"},2:{label:"中見出し",hint:"中見出しが入ります"},3:{label:"小見出し",hint:"小見出しが入ります"},4:{label:"英字見出し",hint:"ENGLISH TITLE"},5:{label:"タイトル",hint:"タイトルが入ります"},6:{label:"本文",hint:"本文が入ります"},7:{label:"単位",hint:"単位が入ります"},8:{label:"数字",hint:"数字が入ります"},9:{label:"中見出し／名前",hint:"名前が入ります"},10:{label:"中見出し／役職・肩書",hint:"肩書が入ります"},11:{label:"数字／価格",hint:"数字（価格）が入ります"},12:{label:"設問",hint:"質問が入ります"},13:{label:"回答",hint:"回答が入ります"},14:{label:"中見出し／フリガナ",hint:"フリガナが入ります"},15:{label:"曜日",hint:"曜日が入ります"},16:{label:"電話番号",hint:"電話番号が入ります"},17:{label:"プラン",hint:"プラン名が入ります"},18:{label:"ボタン",hint:"ボタンテキストが入ります"},19:{label:"タブ",hint:"タブ名が入ります"},20:{label:"時間",hint:"時間が入ります"},21:{label:"アイコン",hint:"アイコンが入ります"},22:{label:"順位",hint:"順位が入ります"}};function checkDataPlaceholder(e,t){let l=t.getAttribute("data-placeholder-id");if(l&&placeholderMapping[l]){let{label:a,hint:i}=placeholderMapping[l];e.setAttribute("data-placeholder-id",l),e.setAttribute("data-label",a),e.setAttribute("data-hint",i)}}function skipEl(e){return"true"===e.getAttribute("data-skip")}function addAttributes(e,t,l){l.forEach(l=>{let a=t.getAttribute(l);a&&e.setAttribute(l,a)})}function dataPlaceholder(e){return e.replace(/<br\s*\/?>/g,"\\n").trim().replace(/\s+/g," ").replace(/<span[^>]*>/g,"").replace(/<\/span>/g,"")}function setDefaultLabelAndHint(e,t,l){e.hasAttribute("data-label")||e.setAttribute("data-label",t),e.hasAttribute("data-hint")||e.setAttribute("data-hint",l)}function handleIframe(e){let t=document.createElement("editable"),l=e.getAttribute("data-type"),a=e.getAttribute("data-max")||"1000";if("movie"===l){t.setAttribute("data-type","movie");let i=e.getAttribute("src");i&&t.setAttribute("data-sample",i),setDefaultLabelAndHint(t,"動画 URL","")}else if("map"===l){t.setAttribute("data-type","map"),e.removeAttribute("data-type"),e.removeAttribute("data-max");let n=encodeURIComponent(e.outerHTML);t.setAttribute("data-sample",n),setDefaultLabelAndHint(t,"地図 URL","")}return t.setAttribute("data-max",a),addAttributes(t,e,attributesToCopy.iframe),t}function handleLoopElements(e){let t=e.querySelectorAll("div[data-type='loop-grid'], div[data-type='loop-list'], div[data-type='loop-table']");t.forEach(e=>{let t=document.createElement("editable");t.setAttribute("data-type",e.getAttribute("data-type")),t.setAttribute("class",e.getAttribute("class"));let l=e.getAttribute("data-item-row");l&&t.setAttribute("data-item-row",l);let a=e.getAttribute("data-item-column");a&&t.setAttribute("data-item-column",a),e.parentNode.replaceChild(t,e)})}function replaceElements(e){function t(e){let t=e;for(;t.parentNode;)if(["job","recruitment"].includes((t=t.parentNode).getAttribute("data-type")))return!0;return!1}!function l(a,i){for(let n=1;n<=6;n++){let o=e.querySelectorAll(`h${n}`);o.forEach(e=>{if(!t(e)&&!skipEl(e)){let l=document.createElement("editable");l.setAttribute("data-type","headline"),l.setAttribute("data-html-tag",`h${n}`);let a=dataPlaceholder(e.innerHTML);l.setAttribute("data-sample",a),checkDataPlaceholder(l,e),addAttributes(l,e,attributesToCopy.headline),e.parentNode.replaceChild(l,e)}})}}(1,6);let l=e.querySelectorAll("img");l.forEach(e=>{if(skipEl(e))e.setAttribute("src","/img/empty.png");else{let t=document.createElement("editable"),l=e.getAttribute("data-field");if("job.thumbnail"===l)e.removeAttribute("data-field"),e.setAttribute("src","{{job.thumbnail}}"),e.setAttribute("alt","{{job.name}}");else if("recruitment.thumbnail"===l)e.removeAttribute("data-field"),e.setAttribute("src","{{recruitment.thumbnail}}"),e.setAttribute("alt","{{recruitment.title}}");else{t.setAttribute("data-type","image"),("true"===e.getAttribute("data-readonly")||e.hasAttribute("readonly"))&&t.setAttribute("data-readonly","true");let a=e.getAttribute("data-aspect");a&&t.setAttribute("data-aspect",a),setDefaultLabelAndHint(t,"画像",""),addAttributes(t,e,attributesToCopy.image),e.parentNode.replaceChild(t,e)}}});let a=0,i=e.querySelectorAll("label");i.forEach(e=>{if(t(e)){e.removeAttribute("htmlfor");let l=e.querySelectorAll("button");l.forEach(e=>{e.removeAttribute("id"),e.removeAttribute("data-max")})}else{let i=e.querySelector("button");if(i){let n=document.createElement("editable"),o="sg-module-button-"+ ++a;n.setAttribute("id",o),n.setAttribute("data-type","button");let r=dataPlaceholder(i.innerHTML);n.setAttribute("data-sample",r),("true"===i.getAttribute("data-empty")||i.hasAttribute("empty"))&&n.setAttribute("data-empty","true"),checkDataPlaceholder(n,e),addAttributes(n,i,attributesToCopy.button),i.parentNode.replaceChild(n,i),e.setAttribute("htmlfor",o)}}});let n=e.querySelectorAll("p");n.forEach(e=>{if(!t(e)&&!skipEl(e)){let l=e.innerHTML;if(t(e))e.removeAttribute("min"),e.removeAttribute("data-max"),e.removeAttribute("data-type");else{let a=document.createElement("editable");a.setAttribute("data-type",l.includes("<br>")||"multi-text"===e.getAttribute("data-type")?"multi-text":"single-text");let i=dataPlaceholder(l);a.setAttribute("data-sample",i),checkDataPlaceholder(a,e),addAttributes(a,e,attributesToCopy.text),e.parentNode.replaceChild(a,e)}}});let o=e.querySelectorAll("iframe");o.forEach(e=>{let t=handleIframe(e);e.parentNode.replaceChild(t,e)}),["job","recruitment"].forEach(t=>{let l=e.querySelectorAll(`div[data-type='${t}']`);l.forEach((e,l)=>{if(0===l){let a=document.createElement("editable");a.setAttribute("data-type",t);let i=attributesToCopy[t],n=(t,l,i)=>{let n=e.querySelector(`[data-field='${t}']`);if(n){let o=dataPlaceholder(n.innerHTML);a.hasAttribute(l)||a.setAttributeNS(null,l,o||i)}};"job"===t&&(n("job.name","data-sample-name"),n("job.description","data-sample-description")),"recruitment"!==t||(n("recruitment.title","data-sample-title"),n("recruitment.type","data-sample-type"),n("recruitment.location","data-sample-location"),n("recruitment.companyName","data-sample-companyName"),a.hasAttribute("data-sample-salary")||a.setAttribute("data-sample-salary","235,000円"),a.hasAttribute("data-sample-salaryType")||a.setAttributeNS(null,"data-sample-salaryType","月給")),addAttributes(a,e,i);let o=e.firstElementChild.cloneNode(!0);a.appendChild(o),e.parentNode.replaceChild(a,e)}else e.parentNode.removeChild(e)})}),[{type:"job.name",content:"{{job.name}}"},{type:"job.description",content:"{{job.description}}"},{type:"recruitment.company",content:"{{recruitment.companyName}}"},{type:"recruitment.title",content:"{{recruitment.title}}"},{type:"recruitment.type",content:"{{recruitment.type}}"},{type:"recruitment.location",content:"{{recruitment.location}}"},{type:"recruitment.salary",content:"{{recruitment.salaryType}} {{recruitment.salary}}"},].forEach(t=>{let l=e.querySelectorAll(`[data-field='${t.type}']`);l.forEach(e=>{e.removeAttribute("data-field"),e.innerHTML=t.content})});let r=e.querySelectorAll("div[data-type='chart']");r.forEach(e=>{let t=document.createElement("editable");t.setAttribute("data-type","chart"),addAttributes(t,e,attributesToCopy.chart),t.setAttribute("data-chart",e.getAttribute("data-chart"));let l=e.getAttribute("data-options");if(l){let a=l.replace(/\s+/g,"");t.setAttribute("data-options",a)}e.parentNode.replaceChild(t,e)}),handleLoopElements(e)}let idIndex=0;function handleFileProcessing(e,t,l){return new Promise((a,i)=>{let n=e.files[0];if(!n)return alert("Please select a file."),i("No file selected");let o=new FileReader;o.onload=function(e){let n=e.target.result,o=document.createElement("div");o.innerHTML=n;let r=o.querySelector(".root");if(r){let s=r.cloneNode(!0),d=s.querySelectorAll(".root > div"),c=Array.from(d).map((e,a)=>{let i="",n=getBlockComment(e);i+=n,replaceElements(e);let o=getBlockHtml(e);i+=o+"\n<!-- End Module -->\n";let r=e.getAttribute("data-css"),s=e.getAttribute("data-module"),d=e.getAttribute("data-type-name");return displayHTMLContent(i,idIndex++,l,e.classList,t,r,s,d)});Promise.all(c).then(a).catch(i)}else alert('HTML does not have class ".root"'),i('HTML does not have class ".root"')},o.readAsText(n,"UTF-8")})}function displayHTMLContent(e,t,l,a,i,n,o,r){return new Promise(s=>{e=(e=(e=(e=e.replaceAll("></editable>"," />")).replaceAll("</img>","")).replace(/data-module="[^"]*"/g,"").replace("  "," ")).replace(/<editable([^>]*)><\/editable>/g,"<editable$1 />");let d=document.createElement("div");d.className="block";let c=document.createElement("div");c.className="block-cont",n&&c.setAttribute("id",n),o&&d.setAttribute("data-module",o),r&&d.setAttribute("module-type",r);let u=document.createElement("div");u.className="edit-cont";let p=document.createElement("div");p.className="css-cont",c.appendChild(u),c.appendChild(p),d.appendChild(c);let m=document.createElement("pre"),b=document.createElement("code");b.className="line-numbers language-html",b.textContent=e.trim(),m.setAttribute("id","htmlBlock_"+t),m.appendChild(b),u.appendChild(m),Prism.highlightElement(b);let y=createCSSBlock(l,a),h=document.createElement("code");h.className="line-numbers language-css",h.textContent=y;let f=document.createElement("pre");f.setAttribute("id","cssBlock_"+t),f.appendChild(h),p.appendChild(f),Prism.highlightElement(h),i.appendChild(d),s()})}function createCSSBlock(e,t){let l=t[0],a=`.${l} {
`;for(let i=1;i<=e;i++)a+=`  --color${i.toString().padStart(2,"0")}: color-${i};
`;return a+"}"}function countBlocks(e){return e.querySelectorAll(".block").length}function addCssContentToBlock(e,t){Array.from(e).forEach(e=>{if("text/css"===e.type){let l=new FileReader;l.onload=l=>{let a=l.target.result,i=t.querySelectorAll(".block-cont");i.forEach(t=>{if(t.id===e.name){let l=t.querySelector(".css-cont code.language-css");if(l){let i=l.textContent,n=i.indexOf("}")+1,o=i.slice(0,n)+"\n\n"+a;l.textContent=o,Prism.highlightElement(l)}}})},l.readAsText(e)}})}[inputCssFiles,inputCssFiles_sp].forEach(e=>{e.addEventListener("change",()=>{addCssContentToBlock(e.files,"cssFiles"===e.id?htmlDisplay:htmlDisplay_sp),e.parentElement.querySelector("span").textContent=`${e.files.length} files css added`,e.parentElement.classList.add("added")})});