function getBlockComment(e){let t=e.previousSibling;for(;t;){if(t.nodeType===Node.COMMENT_NODE)return"\n<!-- "+t.nodeValue.trim()+" -->\n";t=t.previousSibling}return""}function getBlockHtml(e,t=""){var a="";if(e){a+=t+"<"+e.tagName.toLowerCase();for(var l=0;l<e.attributes.length;l++){var n=e.attributes[l];a+=" "+n.name+'="'+n.value+'"'}if(a+=">",e.childNodes.length>0){for(var r=t+"	",i=!1,l=0;l<e.childNodes.length;l++){var s=e.childNodes[l];if(3===s.nodeType){var o=s.nodeValue.trim();o&&(a+="\n"+r+o)}else if(1===s.nodeType){var d=getBlockHtml(s,r);d&&(a+="\n"+d,i=!0)}}(i||a.includes(r))&&(a+="\n"+t)}a+="</"+e.tagName.toLowerCase()+">"}return a}document.addEventListener("DOMContentLoaded",e=>{let t=document.getElementById("clSelect"),a=document.body,l=document.querySelectorAll("#clSelect .list-color .dot"),n=localStorage.getItem("mode");if(n){a.classList.add(n),document.querySelector("#clSelect > .dot").style.backgroundColor=getComputedStyle(document.getElementById(n)).backgroundColor;let r=document.getElementById(n);r&&(r.style.display="none")}else{a.classList.add("color00");let i=document.querySelector('.list-color [id="color00"]');i&&(i.style.display="none")}t.addEventListener("click",e=>{t.classList.toggle("active")}),l.forEach(e=>{e.addEventListener("click",e=>{e.stopPropagation();let n=e.target.id;l.forEach(e=>{a.classList.contains(e.id)&&(e.style.display="inline-block")}),a.className=a.className.split(" ").filter(e=>!e.startsWith("color")).join(" "),a.classList.add(n),localStorage.setItem("mode",n),document.querySelector("#clSelect > .dot").style.backgroundColor=getComputedStyle(e.target).backgroundColor;let r=document.getElementById(n);r&&(r.style.display="none"),t.classList.remove("active")})}),document.addEventListener("click",e=>{t.contains(e.target)||t.classList.remove("active")})});const attributesToCopy={headline:["class","max","data-sample","data-label","data-hint"],image:["class","data-aspect","data-readonly"],button:["class","max","data-sample","data-label","data-hint","data-empty"],text:["class","max","data-sample","data-label","data-hint"],iframe:["class","max","data-sample","data-label","data-hint"],job:["class","data-type","data-sample-thumbnail","data-sample-name","data-sample-description"],recruitment:["class","data-type","data-sample-thumbnail","data-sample-title","data-sample-type","data-sample-location","data-sample-salary","data-sample-salaryType","data-sample-companyName"]};function addAttributes(e,t,a){a.forEach(a=>{let l=t.getAttribute(a);l&&e.setAttribute(a,l)})}function dataPlaceholder(e){return e.replace(/<br\s*\/?>/g,"\\n").trim().replace(/\s+/g," ")}function setDefaultLabelAndHint(e,t,a){e.hasAttribute("data-label")||e.setAttribute("data-label",t),e.hasAttribute("data-hint")||e.setAttribute("data-hint",a)}function handleIframe(e){let t=document.createElement("editable"),a=e.getAttribute("data-type"),l=e.getAttribute("max")||"1000";if("movie"===a){t.setAttribute("data-type","movie");let n=e.getAttribute("src");n&&t.setAttribute("data-sample",n),setDefaultLabelAndHint(t,"動画 URL","")}else if("map"===a){t.setAttribute("data-type","map"),e.removeAttribute("data-type"),e.removeAttribute("max");let r=encodeURIComponent(e.outerHTML);t.setAttribute("data-sample",r),setDefaultLabelAndHint(t,"地図 URL","")}return t.setAttribute("max",l),addAttributes(t,e,attributesToCopy.iframe),t}function replaceElements(e){function t(e){let t=e;for(;t.parentNode;)if(["job","recruitment"].includes((t=t.parentNode).getAttribute("data-type")))return!0;return!1}function a(a,l,n,r){for(let i=a;i<=l;i++){let s=e.querySelectorAll(`h${i}`);s.forEach(e=>{if(!t(e)){let a=document.createElement("editable");a.setAttribute("data-type","headline"),a.setAttribute("data-html-tag",`h${i}`);let l=dataPlaceholder(e.innerHTML);a.setAttribute("data-sample",l),setDefaultLabelAndHint(a,n,r),addAttributes(a,e,attributesToCopy.headline),e.parentNode.replaceChild(a,e)}})}}a(1,2,"大見出し",""),a(3,6,"見出し","");let l=e.querySelectorAll("img");l.forEach(e=>{let t=document.createElement("editable"),a=e.getAttribute("data-field");if("job.thumbnail"===a)e.removeAttribute("data-field"),e.setAttribute("src","{{job.thumbnail}}"),e.setAttribute("alt","{{job.name}}");else if("recruitment.thumbnail"===a)e.removeAttribute("data-field"),e.setAttribute("src","{{recruitment.thumbnail}}"),e.setAttribute("alt","{{recruitment.title}}");else{t.setAttribute("data-type","image"),("true"===e.getAttribute("data-readonly")||e.hasAttribute("readonly"))&&t.setAttribute("data-readonly","true");let l=e.getAttribute("data-aspect");l&&t.setAttribute("data-aspect",l),setDefaultLabelAndHint(t,"画像",""),addAttributes(t,e,attributesToCopy.image),e.parentNode.replaceChild(t,e)}});let n=0,r=e.querySelectorAll("label");r.forEach(e=>{if(t(e)){e.removeAttribute("htmlfor");let a=e.querySelectorAll("button");a.forEach(e=>{e.removeAttribute("id"),e.removeAttribute("max")})}else{let l=e.querySelector("button");if(l){let r=document.createElement("editable"),i="sg-module-button-"+ ++n;r.setAttribute("id",i),r.setAttribute("data-type","button");let s=dataPlaceholder(l.innerHTML);r.setAttribute("data-sample",s),("true"===l.getAttribute("data-empty")||l.hasAttribute("empty"))&&r.setAttribute("data-empty","true"),setDefaultLabelAndHint(r,"ボタン",""),addAttributes(r,l,attributesToCopy.button),l.parentNode.replaceChild(r,l),e.setAttribute("htmlfor",i)}}});let i=e.querySelectorAll("p");i.forEach(e=>{let a=e.innerHTML;if(t(e))e.removeAttribute("min"),e.removeAttribute("max"),e.removeAttribute("data-type");else{let l=document.createElement("editable");l.setAttribute("data-type",a.includes("<br>")||"multi-text"===e.getAttribute("data-type")?"multi-text":"single-text");let n=dataPlaceholder(a);l.setAttribute("data-sample",n),setDefaultLabelAndHint(l,"本文",""),addAttributes(l,e,attributesToCopy.text),e.parentNode.replaceChild(l,e)}});let s=e.querySelectorAll("iframe");s.forEach(e=>{let t=handleIframe(e);e.parentNode.replaceChild(t,e)}),["job","recruitment"].forEach(t=>{let a=e.querySelectorAll(`div[data-type='${t}']`);a.forEach((e,a)=>{if(0===a){let l=document.createElement("editable");l.setAttribute("data-type",t);let n=attributesToCopy[t],r=(t,a,n)=>{let r=e.querySelector(`[data-field='${t}']`);if(r){let i=dataPlaceholder(r.innerHTML);l.hasAttribute(a)||l.setAttributeNS(null,a,i||n)}};"job"===t&&(r("job.name","data-sample-name"),r("job.description","data-sample-description")),"recruitment"!==t||(r("recruitment.title","data-sample-title"),r("recruitment.type","data-sample-type"),r("recruitment.location","data-sample-location"),r("recruitment.companyName","data-sample-companyName"),l.hasAttribute("data-sample-salary")||l.setAttribute("data-sample-salary","235,000円"),l.hasAttribute("data-sample-salaryType")||l.setAttributeNS(null,"data-sample-salaryType","月給")),addAttributes(l,e,n);let i=e.firstElementChild.cloneNode(!0);l.appendChild(i),e.parentNode.replaceChild(l,e)}else e.parentNode.removeChild(e)})}),[{type:"job.name",content:"{{job.name}}"},{type:"job.description",content:"{{job.description}}"},{type:"recruitment.company",content:"{{recruitment.companyName}}"},{type:"recruitment.title",content:"{{recruitment.title}}"},{type:"recruitment.type",content:"{{recruitment.type}}"},{type:"recruitment.location",content:"{{recruitment.location}}"},{type:"recruitment.salary",content:"{{recruitment.salaryType}} {{recruitment.salary}}"},].forEach(t=>{let a=e.querySelectorAll(`[data-field='${t.type}']`);a.forEach(e=>{e.removeAttribute("data-field"),e.innerHTML=t.content})})}function handleFileChange(e,t){let a=e.files[0];a?t.innerText=a.name:t.innerText="No file chosen"}document.getElementById("fileInput").addEventListener("change",function(){handleFileChange(this,document.getElementById("fileNameSpan"))}),document.getElementById("fileInput_sp").addEventListener("change",function(){handleFileChange(this,document.getElementById("fileNameSpan_sp"))});const ttModulPc=document.getElementById("ttModule_pc"),ttModulSp=document.getElementById("ttModule_sp"),blockDocument=document.getElementById("blockDocument"),blockReturn=document.querySelector(".blockReturn");document.getElementById("extract-html").addEventListener("click",async function(){document.querySelector(".htmlDisplay").innerHTML="",document.querySelector(".htmlDisplay_sp").innerHTML="";let e=parseInt(document.getElementById("colorCountInput").value,10);if(isNaN(e)||e<=0){alert("Please enter a valid number of colors.");return}await handleFileProcessing(document.getElementById("fileInput"),document.querySelector(".htmlDisplay"),e,!0),await handleFileProcessing(document.getElementById("fileInput_sp"),document.querySelector(".htmlDisplay_sp"),e,!1),ttModulPc.innerText=": "+countBlocks(document.querySelector(".htmlDisplay"))+" modules",ttModulSp.innerText=": "+countBlocks(document.querySelector(".htmlDisplay_sp"))+" modules",blockDocument.style.display="none",blockReturn.style.display="flex"}),document.getElementById("clean-html").addEventListener("click",async function(){return location.reload(),!1});let idIndex=0;function handleFileProcessing(e,t,a){return new Promise((l,n)=>{let r=e.files[0];if(!r)return alert("Please select a file."),n("No file selected");let i=new FileReader;i.onload=function(e){let r=e.target.result,i=document.createElement("div");i.innerHTML=r;let s=i.querySelector(".root");if(s){let o=s.cloneNode(!0),d=o.querySelectorAll(".root > div"),c=Array.from(d).map((e,l)=>{let n="",r=getBlockComment(e);n+=r,replaceElements(e);let i=getBlockHtml(e);n+=i+"\n<!-- End Module -->\n";let s=e.getAttribute("data-css");return displayHTMLContent(n,idIndex++,a,e.classList,t,s)}),u=s.querySelectorAll(".root > div");Array.from(u).map(e=>({dataCss:e.getAttribute("data-css"),dataTypeName:e.getAttribute("data-type-name")})),Promise.all(c).then(l).catch(n)}else alert('HTML does not have class ".root"'),n('HTML does not have class ".root"')},i.readAsText(r,"UTF-8")})}function displayHTMLContent(e,t,a,l,n,r){return new Promise(i=>{e=(e=(e=(e=e.replaceAll("></editable>"," />")).replaceAll("</img>","")).replace(/data-type-name="[^"]*"/g,"").replace(/data-css="[^"]*"/g,"").replace("   "," ")).replace(/<editable([^>]*)><\/editable>/g,"<editable$1 />");let s=document.createElement("div");s.className="block";let o=document.createElement("div");o.className="block-cont",r&&o.setAttribute("id",r);let d=document.createElement("div");d.className="edit-cont";let c=document.createElement("div");c.className="css-cont",o.appendChild(d),o.appendChild(c),s.appendChild(o);let u=document.createElement("pre"),m=document.createElement("code");m.className="line-numbers language-html",m.textContent=e.trim(),u.setAttribute("id","htmlBlock_"+t),u.appendChild(m),d.appendChild(u),Prism.highlightElement(m);let p=createCSSBlock(a,l),b=document.createElement("code");b.className="language-css",b.textContent=p;let y=document.createElement("pre");y.setAttribute("id","cssBlock_"+t),y.appendChild(b),c.appendChild(y),Prism.highlightElement(b);let h=document.createElement("button");h.className="copy-css-btn",h.textContent="CSS",h.setAttribute("title","Copy CSS"),h.addEventListener("click",function(){copyContent("cssBlock_"+t,h)}),s.appendChild(h),n.appendChild(s);let f=document.createElement("button");f.className="copy-btn",f.setAttribute("title","Copy HTML"),f.addEventListener("click",function(){copyContent("htmlBlock_"+t,f)}),s.appendChild(f);let g=document.createElement("button");g.className="toggle-btn",g.addEventListener("click",function(){g.classList.toggle("off"),g.parentElement.classList.toggle("off")}),s.appendChild(g),i()})}function copyContent(e,t){let a=document.getElementById(e),l=document.createRange();l.selectNodeContents(a);let n=window.getSelection();n.removeAllRanges(),n.addRange(l),document.execCommand("copy"),n.removeAllRanges(),t.classList.add("loading"),setTimeout(()=>{t.classList.remove("loading")},300)}function createCSSBlock(e,t){let a=t[0],l=`.${a} {
`;for(let n=1;n<=e;n++)l+=`  --color${n.toString().padStart(2,"0")}: color-${n};
`;return l+"}"}function countBlocks(e){return e.querySelectorAll(".block").length}function addCssContentToBlock(e,t){Array.from(e).forEach(e=>{if("text/css"===e.type){let a=new FileReader;a.onload=a=>{let l=a.target.result,n=t.querySelectorAll(".block-cont");n.forEach(t=>{if(t.id===e.name){let a=t.querySelector(".css-cont code.language-css");a&&(a.textContent+="\n\n"+l,Prism.highlightElement(a))}})},a.readAsText(e)}})}document.addEventListener("DOMContentLoaded",e=>{let t=atob("Q29weXJpZ2h0IKkgQWtpcmEgSHQ="),a=document.createElement("span");a.className="cr",a.innerHTML=t,document.body.appendChild(a)});const inputCssFiles=document.getElementById("cssFiles"),inputCssFiles_sp=document.getElementById("cssFiles_sp"),htmlDisplay=document.querySelector(".htmlDisplay"),htmlDisplay_sp=document.querySelector(".htmlDisplay_sp");[inputCssFiles,inputCssFiles_sp].forEach(e=>{e.addEventListener("change",()=>{addCssContentToBlock(e.files,"cssFiles"===e.id?htmlDisplay:htmlDisplay_sp),e.parentElement.querySelector("span").textContent=`${e.files.length} files css added`,e.parentElement.classList.add("added")})});